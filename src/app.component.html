<div class="min-h-screen bg-slate-900 text-slate-200 flex flex-col md:flex-row font-sans">
  
  <aside class="w-full md:w-64 bg-slate-950 border-r border-slate-800 flex-shrink-0 flex flex-col h-screen overflow-hidden sticky top-0">
    <div class="p-6 border-b border-slate-800 bg-slate-950 z-10">
      <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-emerald-400">
        Quant Blueprint
      </h1>
      <p class="text-xs text-slate-500 mt-1">HFT & ML Career Strategy</p>
    </div>

    <nav class="flex-1 overflow-y-auto p-4 space-y-6">
      @for (phase of phases; track phase.id) {
        <div>
          <div class="text-xs font-semibold uppercase tracking-wider mb-2" [class]="phase.color">
            {{ phase.name }}
          </div>
          <div class="space-y-1 relative pl-2 border-l border-slate-800">
            @for (weekId of phase.weeks; track weekId) {
              <button 
                (click)="selectWeek(weekId); setTab('roadmap')"
                class="w-full text-left px-3 py-2 rounded-md text-sm transition-all duration-200 flex items-center group relative"
                [class.bg-slate-800]="selectedWeekId() === weekId"
                [class.text-white]="selectedWeekId() === weekId"
                [class.text-slate-400]="selectedWeekId() !== weekId"
                [class.hover:bg-slate-900]="selectedWeekId() !== weekId"
              >
                <span class="w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2 border transition-colors"
                  [class.border-cyan-500]="selectedWeekId() === weekId"
                  [class.bg-cyan-500]="selectedWeekId() === weekId"
                  [class.text-black]="selectedWeekId() === weekId"
                  [class.border-slate-700]="selectedWeekId() !== weekId"
                >
                  {{ weekId }}
                </span>
                <span class="truncate">第 {{ weekId }} 週</span>
              </button>
            }
          </div>
        </div>
      }
    </nav>
  </aside>

  <main class="flex-1 flex flex-col h-screen overflow-hidden">
    
    <header class="h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-8 flex-shrink-0">
      <div class="flex space-x-6">
        <button (click)="setTab('roadmap')" class="pb-1 text-sm font-medium border-b-2 transition-colors duration-200" [class.border-cyan-500]="activeTab() === 'roadmap'" [class.text-cyan-400]="activeTab() === 'roadmap'" [class.border-transparent]="activeTab() !== 'roadmap'" [class.text-slate-400]="activeTab() !== 'roadmap'"><i class="fas fa-map mr-2"></i> 學習藍圖</button>
        <button (click)="setTab('interview')" class="pb-1 text-sm font-medium border-b-2 transition-colors duration-200" [class.border-cyan-500]="activeTab() === 'interview'" [class.text-cyan-400]="activeTab() === 'interview'" [class.border-transparent]="activeTab() !== 'interview'" [class.text-slate-400]="activeTab() !== 'interview'"><i class="fas fa-brain mr-2"></i> 模擬面試</button>
        <button (click)="setTab('project')" class="pb-1 text-sm font-medium border-b-2 transition-colors duration-200" [class.border-cyan-500]="activeTab() === 'project'" [class.text-cyan-400]="activeTab() === 'project'" [class.border-transparent]="activeTab() !== 'project'" [class.text-slate-400]="activeTab() !== 'project'"><i class="fas fa-laptop-code mr-2"></i> 專題概覽</button>
      </div>
      <div class="flex items-center space-x-3">
        <span class="px-3 py-1 rounded-full bg-slate-800 border border-slate-700 text-xs text-slate-300"><i class="fas fa-user-tie mr-1 text-cyan-500"></i> Target: Prop Trading</span>
      </div>
    </header>

    <div class="flex-1 overflow-y-auto p-6 lg:p-8 bg-slate-900">
      
      @if (activeTab() === 'roadmap') {
        <div class="max-w-7xl mx-auto space-y-6 animate-fade-in pb-20">
          
          <div class="flex flex-col mb-4">
             <div>
                <span class="text-xs font-bold uppercase tracking-wider px-2 py-1 rounded bg-slate-800 text-cyan-400 mb-2 inline-block border border-slate-700">{{ currentPhaseData()?.name }}</span>
                <div class="flex flex-col lg:flex-row lg:items-end justify-between">
                   <h2 class="text-3xl font-bold text-white mt-1">{{ currentWeekData()?.title }}</h2>
                   <div class="text-sm text-slate-500 font-mono mt-2 lg:mt-0">{{ currentDaySchedule()?.day_id }} / 5 DAYS</div>
                </div>
                <p class="text-slate-400 mt-2 leading-relaxed border-l-4 border-slate-700 pl-4 text-sm max-w-4xl">{{ currentWeekData()?.summary }}</p>
             </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-6">
                <div class="flex space-x-1 border-b border-slate-800 overflow-x-auto pb-1 no-scrollbar">
                  @for (day of currentWeekSchedule(); track day.day_id; let i = $index) {
                    <button (click)="selectDay(i)" class="px-4 py-2 text-sm font-medium transition-colors border-b-2 whitespace-nowrap" [class.border-cyan-500]="selectedDayIndex() === i" [class.text-cyan-400]="selectedDayIndex() === i" [class.border-transparent]="selectedDayIndex() !== i" [class.text-slate-500]="selectedDayIndex() !== i">{{ day.day_id }}</button>
                  }
                </div>

                @if (currentDaySchedule(); as day) {
                  <div class="bg-slate-800/50 border-l-4 border-yellow-500 p-4 rounded-r-lg">
                    <div class="flex items-start"><i class="fas fa-lightbulb text-yellow-500 mt-1 mr-3"></i><div><span class="text-xs font-bold text-yellow-500 uppercase tracking-wider">Quant Focus</span><p class="text-sm text-slate-300 mt-1">{{ day.yushi_focus }}</p></div></div>
                  </div>

                  <div class="space-y-4">
                    <div class="bg-slate-950 border border-slate-800 rounded-xl overflow-hidden group hover:border-slate-700 transition-colors flex flex-col">
                      <div class="bg-slate-900 px-4 py-2 border-b border-slate-800 flex justify-between items-center">
                        <div class="flex items-center"><span class="text-[10px] font-bold text-yellow-500 bg-yellow-500/10 px-1.5 py-0.5 rounded mr-3 w-8 text-center">AM</span><span class="text-sm font-bold text-slate-200">THEORY & RESEARCH</span></div>
                        <span class="text-xs text-slate-500 font-mono hidden sm:inline">{{ day.am.topic }}</span>
                      </div>
                      <div class="p-4">
                        <ul class="space-y-2 mb-4">
                          @for (task of day.am.tasks; track task) {
                            <li class="flex items-start cursor-pointer group/item" (click)="toggleTask(task)">
                              <div class="w-5 h-5 border rounded mr-3 flex items-center justify-center flex-shrink-0 transition-colors mt-0.5" [class.bg-yellow-500]="isTaskCompleted(task)" [class.border-yellow-500]="isTaskCompleted(task)" [class.border-slate-700]="!isTaskCompleted(task)">@if (isTaskCompleted(task)) { <i class="fas fa-check text-black text-xs"></i> }</div>
                              <span class="text-sm transition-all" [class.opacity-50]="isTaskCompleted(task)" [class.line-through]="isTaskCompleted(task)" [class.text-slate-500]="isTaskCompleted(task)" [class.text-slate-300]="!isTaskCompleted(task)">{{ task }}</span>
                            </li>
                          }
                        </ul>
                        <div class="border-t border-dashed border-slate-800 pt-3 mt-2">
                           @if (!isEditing('am')) {
                              <div class="group/note cursor-pointer min-h-[30px]" (click)="startEditing('am')">
                                 @if (getNoteContent('am')) {
                                    <div class="text-sm text-slate-400 prose prose-invert prose-sm max-w-none"><markdown [data]="getNoteContent('am')"></markdown></div>
                                 } @else {
                                    <div class="text-xs text-slate-600 italic hover:text-slate-400 transition-colors flex items-center"><i class="fas fa-pen mr-2"></i> Add note...</div>
                                 }
                              </div>
                           } @else {
                              <div class="animate-fade-in">
                                 <textarea #amNote class="w-full bg-slate-900 text-slate-300 p-2 text-sm rounded border border-yellow-500/50 focus:outline-none min-h-[100px] font-mono" [value]="getNoteContent('am')" placeholder="Enter Markdown or LaTeX..."></textarea>
                                 <div class="flex justify-end space-x-2 mt-2"><button (click)="cancelEdit()" class="px-2 py-1 text-xs text-slate-400 hover:text-white">Cancel</button><button (click)="saveNote('am', amNote.value)" class="px-3 py-1 bg-yellow-600 hover:bg-yellow-500 text-white text-xs font-bold rounded">Save</button></div>
                              </div>
                           }
                        </div>
                      </div>
                    </div>

                    <div class="bg-slate-950 border border-slate-800 rounded-xl overflow-hidden group hover:border-slate-700 transition-colors flex flex-col">
                      <div class="bg-slate-900 px-4 py-2 border-b border-slate-800 flex justify-between items-center">
                        <div class="flex items-center"><span class="text-[10px] font-bold text-blue-400 bg-blue-400/10 px-1.5 py-0.5 rounded mr-3 w-8 text-center">PM</span><span class="text-sm font-bold text-slate-200">HIGH PERFORMANCE CODING</span></div>
                         <span class="text-xs text-slate-500 font-mono hidden sm:inline">{{ day.pm.topic }}</span>
                      </div>
                      <div class="p-4">
                        <ul class="space-y-2 mb-4">
                          @for (task of day.pm.tasks; track task) {
                            <li class="flex items-start cursor-pointer group/item" (click)="toggleTask(task)">
                              <div class="w-5 h-5 border rounded mr-3 flex items-center justify-center flex-shrink-0 transition-colors mt-0.5" [class.bg-blue-500]="isTaskCompleted(task)" [class.border-blue-500]="isTaskCompleted(task)" [class.border-slate-700]="!isTaskCompleted(task)">@if (isTaskCompleted(task)) { <i class="fas fa-check text-black text-xs"></i> }</div>
                              <span class="text-sm transition-all" [class.opacity-50]="isTaskCompleted(task)" [class.line-through]="isTaskCompleted(task)" [class.text-slate-500]="isTaskCompleted(task)" [class.text-slate-300]="!isTaskCompleted(task)">{{ task }}</span>
                            </li>
                          }
                        </ul>
                        <div class="border-t border-dashed border-slate-800 pt-3 mt-2">
                           @if (!isEditing('pm')) {
                              <div class="group/note cursor-pointer min-h-[30px]" (click)="startEditing('pm')">
                                 @if (getNoteContent('pm')) {
                                    <div class="text-sm text-slate-400 prose prose-invert prose-sm max-w-none"><markdown [data]="getNoteContent('pm')"></markdown></div>
                                 } @else {
                                    <div class="text-xs text-slate-600 italic hover:text-slate-400 transition-colors flex items-center"><i class="fas fa-pen mr-2"></i> Add note...</div>
                                 }
                              </div>
                           } @else {
                              <div class="animate-fade-in">
                                 <textarea #pmNote class="w-full bg-slate-900 text-slate-300 p-2 text-sm rounded border border-blue-500/50 focus:outline-none min-h-[100px] font-mono" [value]="getNoteContent('pm')" placeholder="Enter Markdown..."></textarea>
                                 <div class="flex justify-end space-x-2 mt-2"><button (click)="cancelEdit()" class="px-2 py-1 text-xs text-slate-400 hover:text-white">Cancel</button><button (click)="saveNote('pm', pmNote.value)" class="px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold rounded">Save</button></div>
                              </div>
                           }
                        </div>
                      </div>
                    </div>

                    <div class="bg-slate-950 border border-slate-800 rounded-xl overflow-hidden group hover:border-slate-700 transition-colors flex flex-col">
                      <div class="bg-slate-900 px-4 py-2 border-b border-slate-800 flex justify-between items-center">
                        <div class="flex items-center"><span class="text-[10px] font-bold text-purple-400 bg-purple-400/10 px-1.5 py-0.5 rounded mr-3 w-8 text-center">NT</span><span class="text-sm font-bold text-slate-200">ALGO & REVIEW</span></div>
                         <span class="text-xs text-slate-500 font-mono hidden sm:inline">{{ day.night.topic }}</span>
                      </div>
                      <div class="p-4">
                        <ul class="space-y-2 mb-4">
                          @for (task of day.night.tasks; track task) {
                            <li class="flex items-start cursor-pointer group/item" (click)="toggleTask(task)">
                              <div class="w-5 h-5 border rounded mr-3 flex items-center justify-center flex-shrink-0 transition-colors mt-0.5" [class.bg-purple-500]="isTaskCompleted(task)" [class.border-purple-500]="isTaskCompleted(task)" [class.border-slate-700]="!isTaskCompleted(task)">@if (isTaskCompleted(task)) { <i class="fas fa-check text-black text-xs"></i> }</div>
                              <span class="text-sm transition-all" [class.opacity-50]="isTaskCompleted(task)" [class.line-through]="isTaskCompleted(task)" [class.text-slate-500]="isTaskCompleted(task)" [class.text-slate-300]="!isTaskCompleted(task)">{{ task }}</span>
                            </li>
                          }
                        </ul>
                        <div class="border-t border-dashed border-slate-800 pt-3 mt-2">
                           @if (!isEditing('night')) {
                              <div class="group/note cursor-pointer min-h-[30px]" (click)="startEditing('night')">
                                 @if (getNoteContent('night')) {
                                    <div class="text-sm text-slate-400 prose prose-invert prose-sm max-w-none"><markdown [data]="getNoteContent('night')"></markdown></div>
                                 } @else {
                                    <div class="text-xs text-slate-600 italic hover:text-slate-400 transition-colors flex items-center"><i class="fas fa-pen mr-2"></i> Add note...</div>
                                 }
                              </div>
                           } @else {
                              <div class="animate-fade-in">
                                 <textarea #ntNote class="w-full bg-slate-900 text-slate-300 p-2 text-sm rounded border border-purple-500/50 focus:outline-none min-h-[100px] font-mono" [value]="getNoteContent('night')" placeholder="LeetCode analysis..."></textarea>
                                 <div class="flex justify-end space-x-2 mt-2"><button (click)="cancelEdit()" class="px-2 py-1 text-xs text-slate-400 hover:text-white">Cancel</button><button (click)="saveNote('night', ntNote.value)" class="px-3 py-1 bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold rounded">Save</button></div>
                              </div>
                           }
                        </div>
                      </div>
                    </div>
                  </div>
                }
            </div>

            <div class="space-y-6">
               <div class="bg-slate-950 border border-slate-800 rounded-xl p-4 flex flex-col items-center relative min-h-[350px]">
                  <div class="w-full flex justify-between items-start mb-4"><h3 class="text-lg font-bold text-slate-200 tracking-wide">能力成長模型</h3><span class="text-[10px] text-emerald-500 bg-emerald-500/10 px-2 py-0.5 rounded border border-emerald-500/20">TOTAL PROFICIENCY</span></div>
                  <div class="flex-1 w-full flex items-center justify-center"><div #radarChart class="w-full h-full flex items-center justify-center"></div></div>
                  <div class="grid grid-cols-2 gap-4 w-full mt-4 pt-4 border-t border-slate-800"><div class="text-center"><div class="text-[10px] text-slate-500 uppercase">Math Proficiency</div><div class="text-xl font-mono font-bold text-slate-200">{{ currentEarnedSkills()['Math'] | number:'1.0-0' }}%</div></div><div class="text-center"><div class="text-[10px] text-slate-500 uppercase">Coding Ability</div><div class="text-xl font-mono font-bold text-slate-200">{{ currentEarnedSkills()['Coding'] | number:'1.0-0' }}%</div></div></div>
               </div>
            </div>
          </div>
        </div>
      }
      </div>
  </main>
</div>
